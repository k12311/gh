<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>第2課：韓文單字＋例句朗讀（iPhone 自動輪播版，黃色系）</title>
  <style>
    :root{
      --yellow:#fff8d5;        /* 背景主色 */
      --yellow-2:#fff3b0;      /* 元件底色 */
      --yellow-dark:#ffe97a;   /* hover */
      --orange:#d9983d;        /* 標題、強調 */
    }
    body{background:var(--yellow);font-family:Arial, 'Noto Sans KR', sans-serif;color:#333;padding:2rem;}
    h1{text-align:center;color:var(--orange);margin-bottom:0.5rem}
    .sub{color:#555;text-align:center;margin-bottom:1rem}
    .panel{display:flex;flex-wrap:wrap;gap:.6rem;justify-content:center;margin:1rem 0 1.2rem}
    .panel button,.panel input[type="range"],.home-link{
      background:var(--yellow-2);
      border:none;padding:.6rem 1rem;border-radius:10px;
      box-shadow:0 3px 6px rgba(0,0,0,.1);
      cursor:pointer;color:#333;
    }
    .panel button:hover,.home-link:hover{background:var(--yellow-dark)}
    .panel small{display:block;margin-top:.25rem;color:#666;text-align:center}
    .status{font-size:.95rem;color:#2b7a0b}

    table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 0 12px rgba(227,165,199,.8)}
    th,td{padding:1rem;border-bottom:1px solid #f8e6b8;vertical-align:top;text-align:left}
    th{background:var(--yellow-2);color:var(--orange)}
    td .btn{background:var(--yellow-2);border:none;padding:6px 12px;border-radius:8px;margin:5px 4px 0 0;cursor:pointer;color:#333}
    td .btn:hover{background:var(--yellow-dark)}
    .flex-center{text-align:center}
    .muted{color:#666;font-size:.9rem}

    @media (max-width: 720px){
      table{font-size:.95rem}
      td{word-break:keep-all}
      .panel{gap:.5rem}
    }
  </style>
</head>
<body>
  <h1>第2課：韓文單字＋例句朗讀</h1>
  <p class="sub">支援 iPhone：先點 <b>🔓 啟動語音</b>。含 <b>自動輪播（單字→例句→停 0.8 秒）</b>、本行播放、全課播放。</p>

  <div class="panel flex-center">
    <button id="unlockTTS">🔓 啟動語音（iPhone 需先點一次）</button>
    <button id="playAll">▶️ 全課播放</button>
    <button id="autoRun">🔁 自動輪播（單字→例句）</button>
    <button id="stopAll">⏹ 停止播放</button>
    <label style="display:flex;align-items:center;gap:.5rem;background:transparent;box-shadow:none;cursor:default">
      <span>語速</span>
      <input id="rate" type="range" min="0.8" max="1.2" step="0.05" value="0.95" />
    </label>
    <button id="diag">🧪 語音診斷</button>
    <span id="status" class="status"></span>
  </div>

  <table id="vocab">
    <thead><tr><th>單字</th><th>中文意思</th><th>例句與朗讀</th></tr></thead>
    <tbody>
      <tr><td>이거</td><td>這個（靠近說話者）</td><td>이거는 사전이에요. / 這是字典。<br><button class="btn" onclick="speak('이거')">🔊 單字</button><button class="btn" onclick="speak('이거는 사전이에요.')">🔊 例句</button></td></tr>
      <tr><td>그거</td><td>那個（靠近聽話者）</td><td>그거는 제 우산이에요. / 那是我的傘。<br><button class="btn" onclick="speak('그거')">🔊 單字</button><button class="btn" onclick="speak('그거는 제 우산이에요.')">🔊 例句</button></td></tr>
      <tr><td>저거</td><td>那個（遠離雙方）</td><td>저거는 선생님의 책이에요. / 那是老師的書。<br><button class="btn" onclick="speak('저거')">🔊 單字</button><button class="btn" onclick="speak('저거는 선생님의 책이에요.')">🔊 例句</button></td></tr>
      <tr><td>이〜</td><td>這個〜</td><td>이 가방은 제 거예요. / 這個包包是我的。<br><button class="btn" onclick="speak('이 가방')">🔊 單字</button><button class="btn" onclick="speak('이 가방은 제 거예요.')">🔊 例句</button></td></tr>
      <tr><td>그〜</td><td>那個〜（靠近聽者）</td><td>그 펜은 당신 거예요? / 那支筆是你的嗎？<br><button class="btn" onclick="speak('그 펜')">🔊 單字</button><button class="btn" onclick="speak('그 펜은 당신 거예요?')">🔊 例句</button></td></tr>
      <tr><td>저〜</td><td>那個〜（遠離雙方）</td><td>저 사람은 학생이에요. / 那個人是學生。<br><button class="btn" onclick="speak('저 사람')">🔊 單字</button><button class="btn" onclick="speak('저 사람은 학생이에요.')">🔊 例句</button></td></tr>
      <tr><td>책</td><td>書</td><td>책을 읽어요. / 看書。<br><button class="btn" onclick="speak('책')">🔊 單字</button><button class="btn" onclick="speak('책을 읽어요.')">🔊 例句</button></td></tr>
      <tr><td>사전</td><td>字典</td><td>사전을 샀어요. / 買了字典。<br><button class="btn" onclick="speak('사전')">🔊 單字</button><button class="btn" onclick="speak('사전을 샀어요.')">🔊 例句</button></td></tr>
      <tr><td>잡지</td><td>雜誌</td><td>잡지를 읽어요. / 看雜誌。<br><button class="btn" onclick="speak('잡지')">🔊 單字</button><button class="btn" onclick="speak('잡지를 읽어요.')">🔊 例句</button></td></tr>
      <tr><td>신문</td><td>報紙</td><td>신문을 읽어요. / 看報紙。<br><button class="btn" onclick="speak('신문')">🔊 單字</button><button class="btn" onclick="speak('신문을 읽어요.')">🔊 例句</button></td></tr>
      <tr><td>노트</td><td>筆記本</td><td>노트에 써요. / 寫在筆記本上。<br><button class="btn" onclick="speak('노트')">🔊 單字</button><button class="btn" onclick="speak('노트에 써요.')">🔊 例句</button></td></tr>
      <tr><td>수첩</td><td>記事本</td><td>수첩을 사용해요. / 使用記事本。<br><button class="btn" onclick="speak('수첩')">🔊 單字</button><button class="btn" onclick="speak('수첩을 사용해요.')">🔊 例句</button></td></tr>
      <tr><td>명함</td><td>名片</td><td>명함을 드려요. / 給對方名片。<br><button class="btn" onclick="speak('명함')">🔊 單字</button><button class="btn" onclick="speak('명함을 드려요.')">🔊 例句</button></td></tr>
      <tr><td>卡드</td><td>卡片</td><td>카드로 결제해요. / 用卡付款。<br><button class="btn" onclick="speak('카드')">🔊 單字</button><button class="btn" onclick="speak('카드로 결제해요.')">🔊 例句</button></td></tr>
      <tr><td>연필</td><td>鉛筆</td><td>연필로 써요. / 用鉛筆寫。<br><button class="btn" onclick="speak('연필')">🔊 單字</button><button class="btn" onclick="speak('연필로 써요.')">🔊 例句</button></td></tr>
      <tr><td>볼펜</td><td>原子筆</td><td>볼펜으로 써요. / 用原子筆寫。<br><button class="btn" onclick="speak('볼펜')">🔊 單字</button><button class="btn" onclick="speak('볼펜으로 써요.')">🔊 例句</button></td></tr>
      <tr><td>샤프</td><td>自動鉛筆</td><td>샤프를 使用해요. / 使用自動鉛筆。<br><button class="btn" onclick="speak('샤프')">🔊 單字</button><button class="btn" onclick="speak('샤프를 使用해요.')">🔊 例句</button></td></tr>
      <tr><td>열쇠</td><td>鑰匙</td><td>열쇠를 잃어버렸어요. / 弄丟鑰匙了。<br><button class="btn" onclick="speak('열쇠')">🔊 單字</button><button class="btn" onclick="speak('열쇠를 잃어버렸어요.')">🔊 例句</button></td></tr>
      <tr><td>시계</td><td>鐘錶</td><td>시계를 봐요. / 看時鐘。<br><button class="btn" onclick="speak('시계')">🔊 單字</button><button class="btn" onclick="speak('시계를 봐요.')">🔊 例句</button></td></tr>
      <tr><td>우산</td><td>傘</td><td>우산을 샀어요. / 買了傘。<br><button class="btn" onclick="speak('우산')">🔊 單字</button><button class="btn" onclick="speak('우산을 샀어요.')">🔊 例句</button></td></tr>
      <tr><td>가방</td><td>包包</td><td>가방을 들었어요. / 拿著包包。<br><button class="btn" onclick="speak('가방')">🔊 單字</button><button class="btn" onclick="speak('가방을 들었어요.')">🔊 例句</button></td></tr>
      <tr><td>CD</td><td>光碟</td><td>CD를 들어요. / 聽CD。<br><button class="btn" onclick="speak('CD')">🔊 單字</button><button class="btn" onclick="speak('CD를 들어요.')">🔊 例句</button></td></tr>
      <tr><td>텔레비전</td><td>電視</td><td>텔레비전을 봐요. / 看電視。<br><button class="btn" onclick="speak('텔레비전')">🔊 單字</button><button class="btn" onclick="speak('텔레비전을 봐요.')">🔊 例句</button></td></tr>
      <tr><td>라디오</td><td>收音機</td><td>라디오를 들어요. / 聽收音機。<br><button class="btn" onclick="speak('라디오')">🔊 單字</button><button class="btn" onclick="speak('라디오를 들어요.')">🔊 例句</button></td></tr>
      <tr><td>카메라</td><td>相機</td><td>카메라로 사진을 찍어요. / 用相機拍照。<br><button class="btn" onclick="speak('카메라')">🔊 單字</button><button class="btn" onclick="speak('카메라로 사진을 찍어요.')">🔊 例句</button></td></tr>
      <tr><td>컴퓨터</td><td>電腦</td><td>컴퓨터를 사용해요. / 使用電腦。<br><button class="btn" onclick="speak('컴퓨터')">🔊 單字</button><button class="btn" onclick="speak('컴퓨터를 사용해요.')">🔊 例句</button></td></tr>
      <tr><td>자동차</td><td>汽車</td><td>자동차를 운전해요. / 開車。<br><button class="btn" onclick="speak('자동차')">🔊 單字</button><button class="btn" onclick="speak('자동차를 운전해요.')">🔊 例句</button></td></tr>
      <tr><td>책상</td><td>桌子</td><td>책상 위에 책이 있어요. / 桌上有書。<br><button class="btn" onclick="speak('책상')">🔊 單字</button><button class="btn" onclick="speak('책상 위에 책이 있어요.')">🔊 例句</button></td></tr>
      <tr><td>의자</td><td>椅子</td><td>의자에 앉아요. / 坐在椅子上。<br><button class="btn" onclick="speak('의자')">🔊 單字</button><button class="btn" onclick="speak('의자에 앉아요.')">🔊 例句</button></td></tr>
      <tr><td>초콜릿</td><td>巧克力</td><td>초콜릿을 먹어요. / 吃巧克力。<br><button class="btn" onclick="speak('초콜릿')">🔊 單字</button><button class="btn" onclick="speak('초콜릿을 먹어요.')">🔊 例句</button></td></tr>
      <tr><td>커피</td><td>咖啡</td><td>커피를 마셔요. / 喝咖啡。<br><button class="btn" onclick="speak('커피')">🔊 單字</button><button class="btn" onclick="speak('커피를 마셔요.')">🔊 例句</button></td></tr>
      <tr><td>선물</td><td>伴手禮、土產</td><td>선물을 샀어요. / 買了伴手禮。<br><button class="btn" onclick="speak('선물')">🔊 單字</button><button class="btn" onclick="speak('선물을 샀어요.')">🔊 例句</button></td></tr>
      <tr><td>영어</td><td>英文</td><td>영어를 말해요. / 說英文。<br><button class="btn" onclick="speak('영어')">🔊 單字</button><button class="btn" onclick="speak('영어를 말해요.')">🔊 例句</button></td></tr>
      <tr><td>일본어</td><td>日文</td><td>일본어를 공부해요. / 學日文。<br><button class="btn" onclick="speak('일본어')">🔊 單字</button><button class="btn" onclick="speak('일본어를 공부해요.')">🔊 例句</button></td></tr>
      <tr><td>~어</td><td>～語</td><td>한국어를 배워요. / 學韓語。<br><button class="btn" onclick="speak('한국어')">🔊 單字</button><button class="btn" onclick="speak('한국어를 배워요.')">🔊 例句</button></td></tr>
      <tr><td>뭐</td><td>什麼</td><td>이게 뭐예요? / 這是什麼？<br><button class="btn" onclick="speak('뭐')">🔊 單字</button><button class="btn" onclick="speak('이게 뭐예요?')">🔊 例句</button></td></tr>
      <tr><td>그래요</td><td>是的</td><td>그래요, 맞아요. / 是的，沒錯。<br><button class="btn" onclick="speak('그래요')">🔊 單字</button><button class="btn" onclick="speak('그래요, 맞아요.')">🔊 例句</button></td></tr>
      <tr><td>아니에요</td><td>不是</td><td>아니에요, 달라요. / 不，不一樣。<br><button class="btn" onclick="speak('아니에요')">🔊 單字</button><button class="btn" onclick="speak('아니에요, 달라요.')">🔊 例句</button></td></tr>
      <tr><td>여기요</td><td>請（請用）</td><td>여기요, 이것 받으세요. / 請，請收下這個。<br><button class="btn" onclick="speak('여기요')">🔊 單字</button><button class="btn" onclick="speak('여기요, 이것 받으세요.')">🔊 例句</button></td></tr>
      <tr><td>감사합니다</td><td>謝謝</td><td>정말 감사합니다. / 非常感謝。<br><button class="btn" onclick="speak('감사합니다')">🔊 單字</button><button class="btn" onclick="speak('정말 감사합니다.')">🔊 例句</button></td></tr>
      <tr><td>그래요?</td><td>是這樣啊？</td><td>그래요? 처음 들었어요. / 是這樣嗎？第一次聽說。<br><button class="btn" onclick="speak('그래요?')">🔊 單字</button><button class="btn" onclick="speak('그래요? 처음 들었어요.')">🔊 例句</button></td></tr>
      <tr><td>저기요</td><td>那個⋯（引起注意）</td><td>저기요, 실례합니다. / 那個，不好意思。<br><button class="btn" onclick="speak('저기요')">🔊 單字</button><button class="btn" onclick="speak('저기요, 실례합니다.')">🔊 例句</button></td></tr>
      <tr><td>어?</td><td>咦？（驚訝）</td><td>어? 이게 뭐예요? / 咦？這是什麼？<br><button class="btn" onclick="speak('어?')">🔊 單字</button><button class="btn" onclick="speak('어? 이게 뭐예요?')">🔊 例句</button></td></tr>
      <tr><td>앞으로 잘 부탁드립니다</td><td>今後請多多指教</td><td>앞으로 잘 부탁드립니다. / 今後請多多指教。<br><button class="btn" onclick="speak('앞으로 잘 부탁드립니다')">🔊 單字</button><button class="btn" onclick="speak('앞으로 잘 부탁드립니다.')">🔊 例句</button></td></tr>
      <tr><td>저야말로</td><td>我才要（請多指教）</td><td>저야말로 잘 부탁드립니다. / 我才要請您多多指教。<br><button class="btn" onclick="speak('저야말로')">🔊 單字</button><button class="btn" onclick="speak('저야말로 잘 부탁드립니다.')">🔊 例句</button></td></tr>
    </tbody>
  </table>
  <div class="flex-center" style="margin-top:1rem">
    <a href="index.html" class="home-link">🔙 回首頁</a>
    <p class="muted">提示：若無聲，先點「啟動語音」，檢查是否連線藍牙耳機，並確認以 HTTPS 開啟。</p>
  </div>

  <script>
    // -----------------------------
    // iPhone 強化型 TTS + 自動輪播（與第1課相同）
    // -----------------------------
    let koVoice = null;
    let speechReady = false;
    let keepAliveTimer = null;
    let autoStop = false;

    const $status = document.getElementById('status');
    const $rate = document.getElementById('rate');

    function loadVoices(){
      const voices = speechSynthesis.getVoices?.() || [];
      koVoice = voices.find(v => (v.lang||'').toLowerCase().startsWith('ko'))
            || voices.find(v => (v.name||'').toLowerCase().includes('korean'))
            || null;
    }
    if('speechSynthesis' in window){
      loadVoices();
      speechSynthesis.onvoiceschanged = loadVoices;
    }

    function ensureResume(){ try{ speechSynthesis.resume(); }catch(e){} }

    function startKeepAlive(){
      stopKeepAlive();
      keepAliveTimer = setInterval(()=>{ if (speechSynthesis.speaking) ensureResume(); }, 900);
    }
    function stopKeepAlive(){ if(keepAliveTimer){ clearInterval(keepAliveTimer); keepAliveTimer=null; } }

    function unlockSpeech(){
      if(!('speechSynthesis' in window)){
        alert('此瀏覽器不支援語音朗讀'); return;
      }
      speechSynthesis.cancel(); ensureResume();
      const u = new SpeechSynthesisUtterance('시작');
      u.lang = 'ko-KR'; if(koVoice) u.voice = koVoice; u.volume = 0;
      u.onend = ()=>{ speechReady = true; const btn = document.getElementById('unlockTTS'); if(btn){ btn.textContent='✅ 語音已啟動（可播放）'; btn.disabled=true; btn.style.opacity=.7; } };
      speechSynthesis.speak(u);
    }

    function chunkKorean(text){
      const t = String(text).trim(); if(!t) return [];
      const parts = t.split(/([.?!…]|[，、。？！]|\s{2,})/).filter(Boolean);
      const merged = [];
      for(let i=0;i<parts.length;i++){
        const cur = parts[i];
        if(/[.?!…，、。？！]/.test(cur) && merged.length){ merged[merged.length-1] += cur; }
        else if(cur.trim()){ merged.push(cur.trim()); }
      }
      const result=[]; let buf='';
      for(const seg of merged){
        if((buf+' '+seg).length <= 40){ buf = buf ? (buf+' '+seg) : seg; }
        else{ if(buf) result.push(buf); buf = seg; }
      }
      if(buf) result.push(buf); return result;
    }

    function speak(text){
      if(!('speechSynthesis' in window)){ alert('此瀏覽器不支援語音朗讀'); return; }
      if(!speechReady && /iPhone|iPad|iPod/i.test(navigator.userAgent)){
        alert('請先點「啟動語音」一次'); return;
      }
      speechSynthesis.cancel(); ensureResume();
      const queue = chunkKorean(text); let idx = 0;
      function playNext(){
        if(idx >= queue.length){ stopKeepAlive(); return; }
        const u = new SpeechSynthesisUtterance(queue[idx]);
        u.lang = 'ko-KR'; if(koVoice) u.voice = koVoice; u.rate = parseFloat($rate?.value || '0.95'); u.pitch = 1.0;
        u.onstart = ()=> startKeepAlive();
        u.onend = ()=> { idx++; playNext(); };
        u.onerror = ()=>{ setTimeout(()=>{ ensureResume(); speechSynthesis.cancel(); setTimeout(()=>speechSynthesis.speak(u),120); },80); };
        speechSynthesis.speak(u);
      }
      playNext();
    }

    function speakChunks(text){
      return new Promise((resolve)=>{
        const parts = chunkKorean(text);
        let i = 0;
        function next(){
          if(i >= parts.length){ stopKeepAlive(); return resolve(); }
          const u = new SpeechSynthesisUtterance(parts[i]);
          u.lang = 'ko-KR'; if(koVoice) u.voice = koVoice; u.rate = parseFloat($rate?.value || '0.95');
          u.onstart = ()=> startKeepAlive();
          u.onend = ()=> { i++; next(); };
          u.onerror = ()=> { setTimeout(()=>{ ensureResume(); speechSynthesis.cancel(); setTimeout(()=>speechSynthesis.speak(u),120); },80); };
          speechSynthesis.speak(u);
        }
        next();
      });
    }

    function playSequence(arr){
      if(!('speechSynthesis' in window)) return;
      if(!speechReady && /iPhone|iPad|iPod/i.test(navigator.userAgent)){
        alert('請先點「啟動語音」一次'); return;
      }
      speechSynthesis.cancel(); ensureResume();
      const seq = arr.flatMap(t => chunkKorean(t));
      let i = 0;
      function next(){
        if(i >= seq.length){ stopKeepAlive(); return; }
        const u = new SpeechSynthesisUtterance(seq[i]);
        u.lang = 'ko-KR'; if(koVoice) u.voice = koVoice; u.rate = parseFloat($rate?.value || '0.95');
        u.onstart = ()=> startKeepAlive();
        u.onend = ()=>{ i++; next(); };
        u.onerror = ()=>{ setTimeout(()=>{ ensureResume(); speechSynthesis.cancel(); setTimeout(()=>speechSynthesis.speak(u),120); },80); };
        speechSynthesis.speak(u);
      }
      next();
    }

    function playAllLessons(){
      const rows = document.querySelectorAll('#vocab tbody tr');
      const seq = [];
      rows.forEach(tr => {
        const w = (tr.cells[0]?.textContent||'').trim().replace(/^~/,'');
        const full = (tr.cells[2]?.textContent||'').trim();
        const s = (full.split('/')[0]||'').trim();
        if(w && s) seq.push(w, s);
      });
      playSequence(seq);
    }

    async function autoCarousel(startIndex=0){
      if(!('speechSynthesis' in window)) return;
      if(!speechReady && /iPhone|iPad|iPod/i.test(navigator.userAgent)){
        alert('請先點「啟動語音」一次'); return;
      }
      autoStop = false;
      const rows = document.querySelectorAll('#vocab tbody tr');
      for(let r=startIndex; r<rows.length; r++){
        if(autoStop) break;
        const tr = rows[r];
        const word = (tr.cells[0]?.textContent||'').trim().replace(/^~/,'');
        const full = (tr.cells[2]?.textContent||'').trim();
        const sentence = (full.split('/')[0]||'').trim();
        if(!word || !sentence) continue;
        speechSynthesis.cancel(); ensureResume();
        await speakChunks(word);
        if(autoStop) break;
        await new Promise(res=> setTimeout(res, 800)); // 0.8 秒
        if(autoStop) break;
        await speakChunks(sentence);
        if(autoStop) break;
        await new Promise(res=> setTimeout(res, 800)); // 行與行之間 0.8 秒
      }
    }

    function autoCarouselFromRow(startTr){
      const rows = Array.from(document.querySelectorAll('#vocab tbody tr'));
      const startIndex = Math.max(0, rows.indexOf(startTr));
      autoCarousel(startIndex);
    }

    function stopAll(){ autoStop = true; speechSynthesis.cancel(); stopKeepAlive(); }

    function diag(){
      if(!('speechSynthesis' in window)){ alert('不支援 speechSynthesis'); return; }
      const voices = speechSynthesis.getVoices?.()||[];
      const foundKo = voices.filter(v=> (v.lang||'').toLowerCase().includes('ko') || (v.name||'').toLowerCase().includes('korean'));
      alert('偵測到語音數：'+voices.length+'\n韓文語音：'+(foundKo.map(v=>v.name+' ['+v.lang+']').join(', ') || '無'));
    }

    function injectRowPlayButtons(){
      const rows = document.querySelectorAll('#vocab tbody tr');
      rows.forEach(tr => {
        const wordCell = tr.cells[0];
        const sentenceCell = tr.cells[2];
        if(!wordCell || !sentenceCell) return;
        const word = (wordCell.textContent||'').trim().replace(/^[~]/,'').replace(/\s*\/.*$/,'');
        const full = (sentenceCell.textContent||'').trim();
        const sentence = (full.split('/')[0]||'').trim();
        if(sentenceCell.querySelector('.rowPlay')) return;
        const btn = document.createElement('button');
        btn.className = 'btn rowPlay';
        btn.textContent = '▶️ 本行播放（單字→例句）';
        btn.addEventListener('click', ()=> playSequence([word, sentence]));
        sentenceCell.appendChild(document.createElement('br'));
        sentenceCell.appendChild(btn);

        const autoBtn = document.createElement('button');
        autoBtn.className = 'btn rowPlay';
        autoBtn.textContent = '🔁 從本行開始輪播';
        autoBtn.addEventListener('click', ()=> autoCarouselFromRow(tr));
        sentenceCell.appendChild(autoBtn);
      });
    }

    // 綁定
    document.getElementById('unlockTTS')?.addEventListener('click', unlockSpeech);
    document.getElementById('playAll')?.addEventListener('click', playAllLessons);
    document.getElementById('autoRun')?.addEventListener('click', ()=> autoCarousel(0));
    document.getElementById('stopAll')?.addEventListener('click', stopAll);
    document.getElementById('diag')?.addEventListener('click', diag);
    document.addEventListener('visibilitychange', ()=>{ if(document.visibilityState==='visible') ensureResume(); });

    injectRowPlayButtons();

    // 對外暴露 speak()（保留表格內 onclick 行為）
    window.speak = speak;
  </script>
</body>
</html>
